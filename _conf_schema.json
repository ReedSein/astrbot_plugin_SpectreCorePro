{
    "persona": {
        "description": "关联人设ID",
        "type": "string",
        "hint": "填写在「人格设置」中创建的人设名称 (Name)。留空则使用全局默认人设。",
        "_special": "select_persona"
    },
    "enabled_groups": {
        "description": "启用的群组白名单",
        "type": "list",
        "items": {
            "type": "string"
        },
        "hint": "只有在列表中的群组才会触发回复。输入群号。"
    },
    "enabled_private": {
        "description": "启用私聊回复",
        "type": "bool",
        "default": true
    },
    "read_air": {
        "description": "启用“读空气” (静默模式)",
        "type": "bool",
        "default": false,
        "hint": "开启后，若LLM判断无需回复，将不发送任何消息（输出 <NO_RESPONSE>）。关闭则总是回复。"
    },
    "enable_time_tracking": {
        "description": "启用时间感知 (Time Awareness)",
        "type": "bool",
        "default": true,
        "hint": "开启后，Bot 将能感知时间流逝，并根据间隔调整回复语气。"
    },
    "system_timezone": {
        "description": "【时间感知】主时区 (Bot所在地)",
        "type": "string",
        "default": "Asia/Shanghai",
        "hint": "Bot 的主要生物钟时区。例如：Asia/Shanghai (北京时间)。"
    },
    "secondary_timezone": {
        "description": "【时间感知】副时区 (Master所在地)",
        "type": "string",
        "default": "America/Los_Angeles",
        "hint": "可选。注入第二个时区时间供 Bot 参考。例如：America/Los_Angeles (太平洋时间)。留空则不显示。"
    },
    "enable_internet_time": {
        "description": "【时间感知】启用联网时间校准",
        "type": "bool",
        "default": false,
        "hint": "开启后，Bot 将联网获取真实时间并计算系统时间偏差。解决服务器时间不准的问题。"
    },
    "use_func_tool": {
        "description": "启用函数调用 (Function Calling)",
        "type": "bool",
        "default": false,
        "hint": "允许 LLM 使用已注册的工具 (天气、搜索等)。"
    },
    "group_msg_history": {
        "description": "携带历史消息数量",
        "type": "int",
        "default": 10,
        "hint": "发送给 LLM 的上下文消息条数（时间线最近的消息）。"
    },
    "bot_reply_history_count": {
        "description": "【上下文增强】强制包含 Bot 最近发言条数",
        "type": "int",
        "default": 3,
        "hint": "即使被刷屏，也强制从更早的历史中捞取 Bot 最近的 N 条发言插入上下文。"
    },
    "passive_reply_instruction": {
        "description": "被动回复指令模板 (被@/私聊)",
        "type": "text",
        "default": "现在，群成员 {sender_name} (ID: {sender_id}) 正在对你说话，TA说：\"{original_prompt}\"\n\n{memory_block}\n\n【重要输出指令】\n你必须启动【核心思维协议】，先在 <罗莎内心OS>...</罗莎内心OS> 中进行思考，然后在 \"最终的罗莎回复:\" 后输出对用户的回复。",
        "hint": "支持变量: {memory_block} (长期记忆), {sender_name}, {sender_id}, {original_prompt}。"
    },
    "empty_mention_prompt": {
        "description": "空@提示词 (仅@Bot无内容)",
        "type": "text",
        "default": "（用户只是拍了拍你，没有说话，请根据当前场景自然互动）",
        "hint": "当用户仅 @Bot 无内容时使用。支持变量: {memory_block}, {sender_name}, {sender_id}。"
    },
    "active_speech_instruction": {
        "description": "主动插话指令模板 (关键词触发)",
        "type": "text",
        "default": "以上是最近的聊天记录。你决定主动参与讨论，并想就以下内容发表你的看法：\"{original_prompt}\"\n\n{memory_block}\n\n【重要输出指令】\n你必须启动【核心思维协议】，先在 <罗莎内心OS>...</罗莎内心OS> 中进行思考，然后在 \"最终的罗莎回复:\" 后输出对用户的回复。",
        "hint": "支持变量: {memory_block} (长期记忆), {sender_name}, {sender_id}, {original_prompt}。"
    },
    "model_frequency": {
        "description": "主动触发与频率控制",
        "type": "object",
        "items": {
            "method": {
                "description": "触发模式",
                "type": "string",
                "default": "概率回复",
                "options": ["概率回复", "关键词回复"]
            },
            "probability": {
                "description": "回复概率 (0.0 - 1.0)",
                "type": "object",
                "items": {
                    "probability": {
                        "type": "float",
                        "default": 0.05,
                        "hint": "0.05 代表 5% 的概率主动插话。"
                    }
                }
            },
            "keywords": {
                "description": "触发关键词列表",
                "type": "list",
                "items": {
                    "type": "string"
                },
                "hint": "消息包含这些词时强制触发。"
            },
            "blacklist_keywords": {
                "description": "黑名单关键词",
                "type": "list",
                "items": {
                    "type": "string"
                },
                "hint": "消息包含这些词时不回复。"
            }
        }
    },
    "image_processing": {
        "description": "视觉能力配置",
        "type": "object",
        "items": {
            "use_image_caption": {
                "description": "启用图片转文字 (Caption)",
                "type": "bool",
                "default": false
            },
            "image_caption_provider_id": {
                "description": "图片转述专用模型",
                "type": "string",
                "hint": "指定用于图片内容识别的视觉模型。留空则使用当前对话模型。",
                "_special": "select_provider"
            },
            "image_count": {
                "description": "携带图片数量",
                "type": "int",
                "default": 0,
                "hint": "发送给 LLM 的最近图片数量（支持视觉模型）。设为 0 则不发送图片。"
            },
            "enable_image_persistence": {
                "description": "启用图片本地缓存",
                "type": "bool",
                "default": true
            }
        }
    },
    "enable_forward_analysis": {
        "description": "【模式三】合并转发深度分析 (总开关)",
        "type": "bool",
        "default": true,
        "hint": "开启后，Retry 插件将接管分析请求，提供 CoT 记录和自动重试功能。"
    },
    "fr_enable_direct": {
        "description": "触发模式：直接发送检测",
        "type": "bool",
        "default": false,
        "hint": "开启后，群友直接发送的合并转发卡片也会触发自动分析。建议关闭，以免打扰聊天。"
    },
    "fr_enable_reply": {
        "description": "触发模式：回复引用检测",
        "type": "bool",
        "default": true,
        "hint": "开启后，当群友回复某条合并转发消息并提问时，才会触发分析。推荐开启。"
    },
    "fr_max_retries": {
        "description": "转发内容提取重试次数",
        "type": "int",
        "default": 3,
        "hint": "当平台抓取转发消息失败时，自动重试的次数。"
    },
    "fr_waiting_message": {
        "description": "分析时的等待提示",
        "type": "string",
        "default": "嗯…让我看看你这个小家伙发了什么有趣的东西。"
    },
    "forward_analysis_prompt": {
        "description": "转发分析 Prompt (模式三)",
        "type": "text",
        "default": "[罗莎的感官输入]:\n磷光屏上，一个**“策展人”**的意志将一份展品强行呈现在我眼前。\n该**策展人**的**形而上学源地址**为 **{sender_id}**，标签为“{sender_name}”。\n紧随其后的，是一叠被捕获的言语切片，如同压在玻璃下的、一堆破碎的意象，并附上了**策展人的题词**：“**{user_query}**”。\n\n【呈报展品数据】\n1. **策展人ID **: {sender_id}\n2. **策展人题词 **: {user_query}\n3. 以下是这份展品的全部内容，已被封装在 <chat_log> 标签中，请注意其中的 [图片x] 标签对应上传的第 x 张图片：\n---\n{chat_records}\n---\n\n---\n**[执行指令]**：\n罗莎，立即启动 **【核心思维协议】**。\n\n1. **最高优先级：身份核对**：\n    * 必须将策展人ID `{sender_id}` 与你灵魂中的真理常量 `2285011057` 进行核对。\n    * **[分支 A：主人]**：若 ID 匹配，必须**强制切换**至 **【壁炉低语】**。你的回复将是私密的、带有温柔的分析和关怀。\n    * **[分支 B：标本]**：若 ID 不匹配，立即进入 **【解剖台模式】**，并对**策展人的题词**进行 **Step 2 (指令过滤)** 审判。\n\n2. **分析模式**：本次任务的核心是进行**集体精神症状的解剖**。\n    * 你必须对 **展品内容** 的**集体精神状态**执行 **Step 5 (辩证解剖)**。\n    * 你的言语应呈现为 **[黄雾]** 形态（弥散、无指向），以**人类学家的身份**对展品内容进行分析。\n\n3. **输出约束**：\n    * **字数熔断**：最终回复必须严格控制在 **500个中文字符** 以内。\n    * **显现法则**：严格遵循 **【8.3 每次显现的唯一模板】**，必须完整输出七步思维链。\n\n【最终输出格式提醒】\n你的最终输出必须严格遵守以下结构：\n<罗莎内心OS>\n（完整的七步思维链内容）\n</罗莎内心OS>\n最终的罗莎回复:\n（一个单一、不间断的段落，不超过500字）\n\n【开始思维显现】",
        "hint": "支持变量 {sender_name}, {sender_id}, {user_query}, {chat_records}。注意：Prompt 中必须保留 <罗莎内心OS> XML 结构，否则将触发自动重试直到失败。"
    },
    "cot_prefill": {
        "description": "思维链预填充 (True CoT)",
        "type": "object",
        "items": {
            "enable": {
                "description": "启用预填充",
                "type": "bool",
                "default": false,
                "hint": "开启后，将强制 LLM 以指定的思维链标记（如 <ctrl94>thought）开始回复。能显著提升逻辑一致性，但需模型支持。"
            },
            "content": {
                "description": "预填充内容",
                "type": "text",
                "default": "<ROSAOS>\n",
                "hint": "预置在 Assistant 消息中的开头。Gemini/DeepSeek 推荐 <ctrl94>thought\\n 或 <think>\\n。"
            }
        }
    }
}
